var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},n=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},r=/constructor/i.test(e.HTMLElement)||e.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},l=function(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var a=e["on"+t[o]];if("function"==typeof a)try{a.call(e,n||e)}catch(e){s(e)}}},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},p=function(s,p,h){h||(s=c(s));var f,u=this,g="application/octet-stream"===s.type,m=function(){l(u,"writestart progress write writeend".split(" "))};if(u.readyState=u.INIT,o)return f=t().createObjectURL(s),void setTimeout(function(){n.href=f,n.download=p,a(n),m(),d(f),u.readyState=u.DONE});!function(){if((i||g&&r)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=i?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,u.readyState=u.DONE,m()},n.readAsDataURL(s),void(u.readyState=u.INIT)}f||(f=t().createObjectURL(s)),g?e.location.href=f:e.open(f,"_blank")||(e.location.href=f),u.readyState=u.DONE,m(),d(f)}()},h=p.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,n){return new p(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs}),function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.findAndReplaceDOMText=t()}(this,function(){function e(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function t(){return n.apply(null,arguments)||o.apply(null,arguments)}function n(e,n,a,r,i){if(n&&!n.nodeType&&arguments.length<=2)return!1;var s="function"==typeof a;s&&(a=function(e){return function(t,n){return e(t.text,n.startIndex)}}(a));var d=o(n,{find:e,wrap:s?null:a,replace:s?a:"$"+(r||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(r>0){var n=e[r];e.index+=e[0].indexOf(n),e[0]=n}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},filterElements:i});return t.revert=function(){return d.revert()},!0}function o(e,t){return new a(e,t)}function a(e,n){var o=n.preset&&t.PRESETS[n.preset];if(n.portionMode=n.portionMode||r,o)for(var a in o)s.call(o,a)&&!s.call(n,a)&&(n[a]=o[a]);this.node=e,this.options=n,this.prepMatch=n.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var r="retain",i=document,s={}.hasOwnProperty;return t.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},t.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},t.NON_INLINE_PROSE=function(e){return s.call(t.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())},t.PRESETS={prose:{forceContext:t.NON_INLINE_PROSE,filterElements:function(e){return!s.call(t.NON_PROSE_ELEMENTS,e.nodeName.toLowerCase())}}},t.Finder=a,a.prototype={search:function(){function t(e){for(var i=0,l=e.length;i<l;++i){var c=e[i];if("string"==typeof c){if(r.global)for(;n=r.exec(c);)s.push(d.prepMatch(n,o++,a));else(n=c.match(r))&&s.push(d.prepMatch(n,0,a));a+=c.length}else t(c)}}var n,o=0,a=0,r=this.options.find,i=this.getAggregateText(),s=[],d=this;return r="string"==typeof r?RegExp(e(r),"g"):r,t(i),s},prepMatch:function(e,t,n){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=n+e.index+e[0].length,e.startIndex=n+e.index,e.index=t,e},getAggregateText:function(){function e(o){if(o.nodeType===Node.TEXT_NODE)return[o.data];if(t&&!t(o))return[];var a=[""],r=0;if(o=o.firstChild)do{if(o.nodeType!==Node.TEXT_NODE){var i=e(o);n&&o.nodeType===Node.ELEMENT_NODE&&(!0===n||n(o))?(a[++r]=i,a[++r]=""):("string"==typeof i[0]&&(a[r]+=i.shift()),i.length&&(a[++r]=i,a[++r]=""))}else a[r]+=o.data}while(o=o.nextSibling);return a}var t=this.options.filterElements,n=this.options.forceContext;return e(this.node)},processMatches:function(){var e,t,n,o=this.matches,a=this.node,r=this.options.filterElements,i=[],s=a,d=o.shift(),l=0,c=0,p=0,h=[a];e:for(;;){if(s.nodeType===Node.TEXT_NODE&&(!t&&s.length+l>=d.endIndex?t={node:s,index:p++,text:s.data.substring(d.startIndex-l,d.endIndex-l),indexInMatch:l-d.startIndex,indexInNode:d.startIndex-l,endIndexInNode:d.endIndex-l,isEnd:!0}:e&&i.push({node:s,index:p++,text:s.data,indexInMatch:l-d.startIndex,indexInNode:0}),!e&&s.length+l>d.startIndex&&(e={node:s,index:p++,indexInMatch:0,indexInNode:d.startIndex-l,endIndexInNode:d.endIndex-l,text:s.data.substring(d.startIndex-l,d.endIndex-l)}),l+=s.data.length),n=s.nodeType===Node.ELEMENT_NODE&&r&&!r(s),e&&t){if(s=this.replaceMatch(d,e,i,t),l-=t.node.data.length-t.endIndexInNode,e=null,t=null,i=[],d=o.shift(),p=0,c++,!d)break}else if(!n&&(s.firstChild||s.nextSibling)){s.firstChild?(h.push(s),s=s.firstChild):s=s.nextSibling;continue}for(;;){if(s.nextSibling){s=s.nextSibling;break}if((s=h.pop())===a)break e}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,t,n){var o=this.options.portionMode;return"first"===o&&t.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,t){var o;switch(t){case"&":o=n[0];break;case"`":o=n.input.substring(0,n.startIndex);break;case"'":o=n.input.substring(n.endIndex);break;default:o=n[+t]}return o}),"first"===o?e:t.isEnd?e.substring(t.indexInMatch):e.substring(t.indexInMatch,t.indexInMatch+t.text.length))},getPortionReplacementNode:function(e,t){var n=this.options.replace||"$&",o=this.options.wrap,a=this.options.wrapClass;if(o&&o.nodeType){var r=i.createElement("div");r.innerHTML=o.outerHTML||(new XMLSerializer).serializeToString(o),o=r.firstChild}if("function"==typeof n)return(n=n(e,t))&&n.nodeType?n:i.createTextNode(String(n));var s="string"==typeof o?i.createElement(o):o;return s&&a&&(s.className=a),(n=i.createTextNode(this.prepareReplacementString(n,e,t))).data&&s?(s.appendChild(n),s):n},replaceMatch:function(e,t,n,o){var a,r,s=t.node,d=o.node;if(s===d){var l=s;t.indexInNode>0&&(a=i.createTextNode(l.data.substring(0,t.indexInNode)),l.parentNode.insertBefore(a,l));var c=this.getPortionReplacementNode(o,e);return l.parentNode.insertBefore(c,l),o.endIndexInNode<l.length&&(r=i.createTextNode(l.data.substring(o.endIndexInNode)),l.parentNode.insertBefore(r,l)),l.parentNode.removeChild(l),this.reverts.push(function(){a===c.previousSibling&&a.parentNode.removeChild(a),r===c.nextSibling&&r.parentNode.removeChild(r),c.parentNode.replaceChild(l,c)}),c}a=i.createTextNode(s.data.substring(0,t.indexInNode)),r=i.createTextNode(d.data.substring(o.endIndexInNode));for(var p=this.getPortionReplacementNode(t,e),h=[],f=0,u=n.length;f<u;++f){var g=n[f],m=this.getPortionReplacementNode(g,e);g.node.parentNode.replaceChild(m,g.node),this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(g,m)),h.push(m)}var v=this.getPortionReplacementNode(o,e);return s.parentNode.insertBefore(a,s),s.parentNode.insertBefore(p,s),s.parentNode.removeChild(s),d.parentNode.insertBefore(v,d),d.parentNode.insertBefore(r,d),d.parentNode.removeChild(d),this.reverts.push(function(){a.parentNode.removeChild(a),p.parentNode.replaceChild(s,p),r.parentNode.removeChild(r),v.parentNode.replaceChild(d,v)}),v}},t});var Graph=function(){function e(){a=[],r=[],f=1}function t(e,t){a.push({data:{id:e,name:t},classes:"multiline-auto"})}function n(e,t){for(var n=!1,o={data:{source:e,target:t}},a=0;a<r.length;a++)if(r[a].data.source===o.data.source&&r[a].data.target===o.data.target){n=!0;break}n||r.push(o)}function o(e){if(l.batch(function(){l.$().removeClass("selected")}),c.style.display="none",e.target&&e.target!=l&&e.target.isNode()){c.style.display="block",e.target.addClass("selected");var t=e.target.id()-1;if(t){for(var n="",o=0;o<s.length;o++){var a=s[o].dataset.parentId;if(a>t)break;a==t&&(n+=s[o].innerHTML+"<span class='u-pull-right'>"+d[o].innerHTML+"</span><br/>")}p.innerHTML="<span id='node-selected'>"+i[t].dataset.objectId+'</span>."'+i[t].dataset.objectDescription+'"<br/>Parent: '+i[t].dataset.objectParent+"<br/>Child: "+i[t].dataset.objectChild+"<br/><div class='accordion-header'>Properties</div>"+n}}}var a,r,i,s,d,l,c,p,h,f;return e.prototype.fill_nodes_and_edges=function(e,o,a){i=e,s=o,d=a;for(var l=-1,c={},p=0;p<i.length;p++)t(i[p].dataset.objectId,i[p].dataset.objectDescription),"0"!=i[p].dataset.objectParent&&n(i[p].dataset.objectId,i[p].dataset.objectParent),"0"!=i[p].dataset.objectChild&&n(i[p].dataset.objectChild,i[p].dataset.objectId),"compass"==i[p].dataset.objectDescription&&(l=i[p].dataset.objectId),i[p].dataset.objectParent==l&&(c[i[p].dataset.objectId]=i[p].dataset.objectDescription.replace(" wall",""));for(p=0;p<s.length;p++)for(var h in c)if(s[p].innerHTML==h){var f=s[p].dataset.parentId,u=parseInt(d[p].innerHTML,16);if(u>0&&u<i.length){var g={data:{source:f,target:u,label:c[h]},classes:"autorotate edge-direction"};r.push(g)}}},e.prototype.create_cy_graph=function(e,t,n){c=t,p=n,fetch("static/style/graph.json",{mode:"no-cors"}).then(function(e){return e.json()}).then(function(t){(l=cytoscape({container:document.querySelector("#cy"),boxSelectionEnabled:!0,style:t,elements:{nodes:a,edges:r},minZoom:.1,maxZoom:2,layout:{name:"cose",nodeDimensionsIncludeLabels:!0,idealEdgeLength:200,edgeElasticity:4e3,nodeRepulsion:7e3,componentSpacing:200}})).ready(function(t){e.style.display="none",l.on("select",function(e){o(e)}),l.on("tap",function(e){o(e)})})})},e.prototype.clear_highlights=function(e){l.batch(function(){h&&(h.removeClass("hidden-transparent"),e.checked&&l.animate({fit:{eles:l.$(),padding:20}},{duration:500}))})},e.prototype.highlight_neighbors=function(e,t){l.batch(function(){var n=l.$(e);o({target:n});var a=n.closedNeighborhood();(h=l.elements().not(a)).addClass("hidden-transparent"),t.checked&&l.animate({fit:{eles:a,padding:20}},{duration:500})})},e.prototype.toggle_labelled_edges=function(e){l.batch(function(){var t=l.edges("edge[?label]");e?t.removeClass("hidden"):t.addClass("hidden")})},e.prototype.hide_objects=function(e){l.batch(function(){l.nodes(e).addClass("hidden")})},e.prototype.hide_objects_to_floor=function(t){l.batch(function(){f>parseInt(t)&&l.nodes("node[id<"+f+"]").removeClass("hidden"),e.prototype.hide_objects("node[id<"+parseInt(t)+"]")}),f=parseInt(t)},e.prototype.reset=function(){l.batch(function(){l.$().removeClass("hidden"),l.$().removeClass("hidden-transparent"),l.$().removeClass("selected"),l.animate({fit:{eles:l.$(),padding:20}},{duration:500})})},e.prototype.get_png_blob=function(){return l.png({output:"blob"})},e}();!function(e,t,n){function o(){if(a&&a.revert(),C.clear_highlights(E),h.value.replace(new RegExp(" ","g"),"").length>0&&(C.highlight_neighbors('node[name @*="'+h.value+'"]',E),a=findAndReplaceDOMText(I,{find:new RegExp(h.value,"gi"),wrap:"span",wrapClass:"highlight"}),e.getElementById("scroll-to-text").checked)){for(r=0;r<p.length;r++)p[r].classList.contains("active")&&p[r].click();for(var t=!1,n=!1,o=e.getElementsByClassName("highlight"),r=0;r<o.length;r++){for(var i=o[r];i&&i.classList&&!i.classList.contains("panel")&&!i.classList.contains("accordion");)!t&&i.classList.contains("word-panel")&&(i.scrollTop=o[r].offsetTop-i.offsetTop,t=!0),!n&&i.classList.contains("object-panel")&&(i.scrollTop=o[r].offsetTop-i.offsetTop,n=!0),i=i.parentNode;i&&i.parentNode&&!i.parentNode.getElementsByClassName("accordion")[0].classList.contains("active")&&i.parentNode.getElementsByClassName("accordion")[0].click()}}}var a,r=e.getElementsByClassName("object-info"),i=e.getElementsByClassName("object-property-number"),s=e.getElementsByClassName("object-property-value"),d=e.getElementById("loading"),l=e.getElementById("node-info-container"),c=e.getElementById("node-info-box"),p=e.getElementsByClassName("accordion"),h=e.getElementById("search-box"),f=e.getElementsByClassName("clear-icon")[0],u=e.getElementById("download-png"),g=e.getElementById("compass-routing"),m=e.getElementById("inform-object-floor"),v=e.getElementById("reset-graph"),y=e.getElementsByClassName("highlight-icon")[0],b=e.getElementsByClassName("unhighlight-icon")[0],N=e.getElementsByClassName("hide-icon")[0],E=e.getElementById("zoom-pan"),x=e.getElementById("menu"),I=e.getElementById("info-box"),T=e.getElementById("cy"),L=!1,C=new Graph;C.fill_nodes_and_edges(r,i,s),C.create_cy_graph(d,l,c);for(var _=0;_<p.length;_++)p[_].addEventListener("click",function(e){this.classList.toggle("active");var t=this.nextElementSibling;t.style.maxHeight?t.style.maxHeight=null:t.style.maxHeight=t.scrollHeight+"px"});p[p.length-1].click(),h.addEventListener("keypress",function(e){13==e.which&&(h.select(),o())}),h.addEventListener("keyup",function(e){h.value.replace(" ","").length>0?f.style.display="block":f.style.display="none"}),f.addEventListener("click",function(e){h.value="",f.style.display="none",o()}),u.addEventListener("click",function(t){var n=C.get_png_blob(),o=e.getElementById("filename").innerHTML;o=o.substr(0,o.lastIndexOf("."))+".png",saveAs(n,o)}),g.addEventListener("click",function(e){C.toggle_labelled_edges(g.checked)}),m.addEventListener("click",function(e){e.stopPropagation()}),m.addEventListener("change",function(e){C.hide_objects_to_floor(m.value)}),v.addEventListener("click",function(e){C.reset(),m.value="1",g.checked=!0,E.checked=!0,l.style.display="none"}),y.addEventListener("click",function(t){C.clear_highlights(E),C.highlight_neighbors('node[id ="'+e.getElementById("node-selected").innerHTML+'"]',E)}),b.addEventListener("click",function(e){C.clear_highlights(E)}),N.addEventListener("click",function(t){C.hide_objects('node[id ="'+e.getElementById("node-selected").innerHTML+'"]'),l.style.display="none"}),x.addEventListener("click",function(e){I.classList.toggle("slide-in"),T.classList.toggle("slide-out"),"M"==x.innerHTML.trim()[0]?("none"!=l.style.display&&(L=!0,l.style.display="none"),x.innerHTML="G<br>R<br>A<br>P<br>H"):(L&&(L=!1,l.style.display="block"),x.innerHTML="M<br>E<br>N<br>U")})}(document,window);